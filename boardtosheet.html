<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üè≠ Factory Layout Dashboard</title>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-blue: #1e40af;
      --secondary-blue: #3b82f6;
      --light-blue: #dbeafe;
      --dark-blue: #1e3a8a;
      --accent-blue: #60a5fa;
      --white: #ffffff;
      --light-gray: #f8fafc;
      --border-gray: #e2e8f0;
      --text-dark: #1e293b;
      --text-light: #64748b;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --success-green: #10b981;
      --warning-orange: #f59e0b;
      --danger-red: #ef4444;
    }

    body {
      font-family: 'Kanit', sans-serif;
      background: linear-gradient(135deg, var(--light-gray) 0%, #e0f2fe 100%);
      min-height: 100vh;
      color: var(--text-dark);
      padding: 0;
      user-select: none;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
      padding: 1rem 2rem 1.2rem 2rem;
      border-radius: 16px;
      margin-bottom: 1.2rem;
      box-shadow: var(--shadow-lg);
      color: var(--white);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0;
      line-height: 1;
    }
    .header h1 i {
      font-size: 2.5rem;
      margin-top: 2px;
    }
    .header p {
      font-size: 1rem;
      opacity: 0.9;
      font-weight: 300;
      margin: 0;
    }
    .header-menu {
      display: flex;
      gap: 1rem;
    }
    .header-menu-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 12px;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--white);
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      user-select: none;
    }
    .header-menu-btn:hover:not(.active) {
      background: rgba(255,255,255,0.4);
      transform: translateY(-2px);
    }
    .header-menu-btn.active {
      background: var(--white);
      color: var(--primary-blue);
      font-weight: 700;
      cursor: default;
      box-shadow: var(--shadow-lg);
    }

    /* Controls Section (date filters) */
    .controls {
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .input-group {
      position: relative;
      display: flex;
      align-items: center;
    }
    .input-group i {
      position: absolute;
      left: 10px;
      color: var(--text-light);
      font-size: 1rem;
      pointer-events: none;
    }
    .input-group input {
      padding: 0.5rem 0.75rem 0.5rem 2.5rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 2px solid var(--border-gray);
      outline: none;
      font-family: 'Kanit', sans-serif;
      transition: border-color 0.3s ease;
      width: 150px;
    }
    .input-group input:focus {
      border-color: var(--secondary-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    #btnFilter {
      background: var(--primary-blue);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    #btnFilter:hover {
      background: var(--secondary-blue);
    }
    #btnResetLayout {
      background: var(--warning-orange);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
      margin-left: auto;
    }
    #btnResetLayout:hover {
      background: #e67e22;
    }

    /* Factory Layout Section */
    .factory-layout {
      background: var(--white);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      min-height: 80vh;
      overflow: hidden; /* Changed from visible to hidden to ensure children respect bounds */
    }
    .layout-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 2rem;
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      align-items: center;
    }
    .factory-floor {
      position: relative;
      width: 100%;
      height: 750px;
      background: url('https://nicklp-rmt.github.io/D365InventoryData/pic/layout.jpg') no-repeat center center;
      background-size: cover;
      border: 3px solid var(--border-gray);
      border-radius: 12px;
      overflow: hidden; /* Changed from visible to hidden for correct drag behavior */
    }

    /* Process Area styles */
    .process-area {
      position: absolute;
      border: 2px solid var(--border-gray);
      border-radius: 12px;
      background-color: rgba(255, 255, 255, 0.85);
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s ease; /* Removed transform from transition */
      cursor: grab;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 1rem;
      min-width: 150px;
      min-height: 120px;
      user-select: none;
      touch-action: none;
      /* transform property will be set by JavaScript */
    }
    .process-area.dragging {
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      z-index: 100;
      cursor: grabbing;
    }
    .process-area:hover {
      box-shadow: var(--shadow-lg);
      z-index: 20;
    }
    .process-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      pointer-events: none;
    }
    .process-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      pointer-events: none;
    }
    .process-count {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      pointer-events: none;
      min-height: 30px;
    }
    .process-status {
      font-size: 0.8rem;
      margin-top: 0.25rem;
      opacity: 0.8;
      pointer-events: none;
    }

    /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô */
    .powder-mixing { top: 50px; left: 50px; }
    .compact { top: 50px; left: 250px; }
    .sinter-steam { top: 50px; left: 450px; }
    .finishing { top: 50px; left: 650px; }
    .machining { top: 250px; left: 50px; }
    .sub-store { top: 250px; left: 250px; }
    .final-inspection { top: 250px; left: 450px; }
    .magna-flux { top: 250px; left: 650px; }
    .sort { top: 450px; left: 50px; }
    .pack { top: 450px; left: 250px; }
    .rework { top: 450px; left: 450px; }

    /* ‡∏™‡∏µ‡πÅ‡∏•‡∏∞ animation ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô */
    .high-volume {
      border-color: var(--success-green);
      background: linear-gradient(135deg, rgba(236, 253, 245, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-green 2s infinite;
    }
    .medium-volume {
      border-color: var(--warning-orange);
      background: linear-gradient(135deg, rgba(255, 251, 235, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-orange 2s infinite;
    }
    .low-volume {
      border-color: var(--danger-red);
      background: linear-gradient(135deg, rgba(254, 242, 242, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-red 2s infinite;
    }
    @keyframes pulse-green {
      0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(16,185,129,0); }
    }
    @keyframes pulse-orange {
      0%, 100% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(245,158,11,0); }
    }
    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(239,68,68,0); }
    }

    /* Resize handles */
    .resize-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--primary-blue);
      opacity: 0;
      border-radius: 2px;
      z-index: 25;
      user-select: none;
      transition: opacity 0.3s ease;
      cursor: nwse-resize;
      right: -3px;
      bottom: -3px;
    }
    .process-area:hover .resize-handle {
      opacity: 0.7;
    }
    .resize-handle:hover {
      opacity: 1 !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .factory-floor {
        /*
        transform: scale(0.8);
        transform-origin: top left;
        Removing scale might provide more predictable drag/resize behavior
        on small screens if combined with specific element positioning adjustments.
        Otherwise, restrictRect in interact.js might need adjustment.
        */
        height: 500px;
      }
      .header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }
      .header h1 {
        font-size: 1.5rem;
      }
      .controls {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-row">
        <h1><i class="fas fa-industry"></i> Factory Layout Dashboard</h1>
        <div id="currentDatetime" style="font-size:1rem; font-weight: 500; opacity: 0.9;"></div>
      </div>
      <div class="header-row">
        <p>‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô CHP</p>
        <nav class="header-menu">
          <a href="boardtosheet.html" class="header-menu-btn active" id="btnDashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
          <a href="reporttosheet.html" class="header-menu-btn" id="btnSearch"><i class="fas fa-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
        </nav>
      </div>
    </div>

    <div class="controls">
      <div class="input-group">
        <i class="fas fa-calendar-alt"></i>
        <input type="text" id="startDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" autocomplete="off" />
      </div>
      <div class="input-group">
        <i class="fas fa-calendar-alt"></i>
        <input type="text" id="endDate" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î" autocomplete="off" />
      </div>
      <button id="btnFilter">‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
      <button id="btnResetLayout">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</button>
    </div>

<!-- ‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÇ‡∏´‡∏•‡∏î -->
<div id="loadingIndicator" style="display:none; text-align:center; margin:1rem 0; color:#64748b;">
  <i class="fas fa-spinner fa-spin" style="font-size:1.5rem;"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
</div>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏µ -->
<div class="legend-box" style="display:flex; gap:1.5rem; align-items:center; margin-bottom:1rem; font-size:0.9rem;">
  <div><span style="display:inline-block;width:14px;height:14px;background:rgba(236,253,245,0.85);border:2px solid #10b981; margin-right:6px;"></span> ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏°‡∏≤‡∏Å (&gt; 1000)</div>
  <div><span style="display:inline-block;width:14px;height:14px;background:rgba(255,251,235,0.85);border:2px solid #f59e0b; margin-right:6px;"></span> ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (500‚Äì1000)</div>
  <div><span style="display:inline-block;width:14px;height:14px;background:rgba(254,242,242,0.85);border:2px solid #ef4444; margin-right:6px;"></span> ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≠‡∏¢ (&lt; 500)</div>
</div>

    
    <div class="factory-layout">
      <div class="layout-title"><i class="fas fa-map"></i> ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</div>
      <div class="factory-floor">
        <div class="process-area powder-mixing high-volume" data-id="powder-mixing">
          <div class="process-icon"><i class="fas fa-flask"></i></div>
          <div class="process-name">‡∏ú‡∏™‡∏°‡∏ú‡∏á</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area compact medium-volume" data-id="compact">
          <div class="process-icon"><i class="fas fa-compress-arrows-alt"></i></div>
          <div class="process-name">Compact</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area sinter-steam high-volume" data-id="sinter-steam">
          <div class="process-icon"><i class="fas fa-fire"></i></div>
          <div class="process-name">Sinter & Steam</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area finishing medium-volume" data-id="finishing">
          <div class="process-icon"><i class="fas fa-gem"></i></div>
          <div class="process-name">Finishing</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area machining high-volume" data-id="machining">
          <div class="process-icon"><i class="fas fa-cog"></i></div>
          <div class="process-name">Machining</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area sub-store medium-volume" data-id="sub-store">
          <div class="process-icon"><i class="fas fa-warehouse"></i></div>
          <div class="process-name">Sub Store</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area final-inspection medium-volume" data-id="final-inspection">
          <div class="process-icon"><i class="fas fa-clipboard-check"></i></div>
          <div class="process-name">Final Inspection</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area magna-flux low-volume" data-id="magna-flux">
          <div class="process-icon"><i class="fas fa-magnet"></i></div>
          <div class="process-name">Magna flux</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area sort medium-volume" data-id="sort">
          <div class="process-icon"><i class="fas fa-sort-amount-down"></i></div>
          <div class="process-name">Sort</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area pack medium-volume" data-id="pack">
          <div class="process-icon"><i class="fas fa-box"></i></div>
          <div class="process-name">Pack</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
        <div class="process-area rework low-volume" data-id="rework">
          <div class="process-icon"><i class="fas fa-tools"></i></div>
          <div class="process-name">Rework</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/@interactjs/interactjs/dist/interact.min.js"></script>

  <script>
   

    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£
    const processList = [
      '‡∏ú‡∏™‡∏°‡∏ú‡∏á',
      'Compact',
      'Sinter & Steam',
      'Finishing',
      'Machining',
      'Sub Store',
      'Final Inspection',
      'Magna flux',
      'Sort',
      'Pack',
      'Rework'
    ];

    // ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ ‡πÄ‡∏õ‡πá‡∏ô data-id
    function getDataIdFromProcessName(procName) {
      const map = {
        '‡∏ú‡∏™‡∏°‡∏ú‡∏á': 'powder-mixing',
        'Compact': 'compact',
        'Sinter & Steam': 'sinter-steam',
        'Finishing': 'finishing',
        'Machining': 'machining',
        'Sub Store': 'sub-store',
        'Final Inspection': 'final-inspection',
        'Magna flux': 'magna-flux',
        'Sort': 'sort',
        'Pack': 'pack',
        'Rework': 'rework'
      };
      return map[procName] || '';
    }

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï process counts ‡∏û‡∏£‡πâ‡∏≠‡∏° filter ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    async function loadProcessDataWithDateFilter() {
  const start = document.getElementById('startDate').value;
  const end = document.getElementById('endDate').value;
  const loadingEl = document.getElementById('loadingIndicator');
  loadingEl.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÇ‡∏´‡∏•‡∏î

  try {
    const url = 'https://script.google.com/macros/s/AKfycbwYy1acBX-V37hiU8lhTY-9YGWgVjVplQOIzhNg1-cNispv6L43_rCVRXVO-HqAfik/exec?page=getInventory';
    const res = await fetch(url);
    const data = await res.json();

    const filtered = data.filter(row => {
      const rawDate = row.Timestamp;
      const dateOnly = new Date(rawDate).toISOString().split('T')[0];
      return (!start || dateOnly >= start) && (!end || dateOnly <= end);
    });

    const countMap = {};
    processList.forEach(p => countMap[p] = 0);

    filtered.forEach(row => {
      if (row.mainProcess && countMap.hasOwnProperty(row.mainProcess)) {
        countMap[row.mainProcess] += Number(row.Quantity || 0);
      }
    });

    processList.forEach(proc => {
      const dataId = getDataIdFromProcessName(proc);
      const el = document.querySelector(`.process-area[data-id="${dataId}"]`);
      if (el) {
        const countEl = el.querySelector('.process-count');
        if (countEl) {
          const qty = countMap[proc] || 0;
          countEl.textContent = qty.toLocaleString();

          el.classList.remove('high-volume', 'medium-volume', 'low-volume');
          if (qty > 1000) {
            el.classList.add('high-volume');
          } else if (qty >= 500) {
            el.classList.add('medium-volume');
          } else {
            el.classList.add('low-volume');
          }
        }
      }
    });

  } catch (error) {
    console.error('‚ùå Failed to load process data:', error);
  } finally {
    loadingEl.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ß‡∏á‡∏•‡πâ‡∏≠‡πÇ‡∏´‡∏•‡∏î
  }
}


    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô header
    function updateDatetime() {
      const el = document.getElementById('currentDatetime');
      const now = new Date();
      el.textContent = now.toLocaleString('th-TH', {
        year: 'numeric', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit'
      });
    }
    setInterval(updateDatetime, 1000);
    updateDatetime();

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î flatpickr ‡∏ö‡∏ô input
    flatpickr('#startDate', { dateFormat: 'Y-m-d' });
    flatpickr('#endDate', { dateFormat: 'Y-m-d' });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
    document.getElementById('btnFilter').addEventListener('click', loadProcessDataWithDateFilter);

    // ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
    document.getElementById('btnResetLayout').addEventListener('click', () => {
      localStorage.clear(); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage
      document.querySelectorAll('.process-area').forEach(card => {
        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ top, left ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å CSS ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î
        const style = window.getComputedStyle(card);
        const initialTop = parseFloat(style.top);
        const initialLeft = parseFloat(style.left);

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï transform ‡πÅ‡∏•‡∏∞ data-x, data-y ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ô CSS
        card.style.transform = `translate(0px, 0px)`; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï translate ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0,0 ‡∏Å‡πà‡∏≠‡∏ô
        card.setAttribute('data-x', '0'); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï data-x ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0
        card.setAttribute('data-y', '0'); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï data-y ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0

        // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å interact.js ‡∏à‡∏∞‡πÉ‡∏ä‡πâ transform: translate() ‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î top/left ‡∏ú‡πà‡∏≤‡∏ô CSS ‡πÑ‡∏ß‡πâ
        // ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ interact.js ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ transform ‡∏ï‡πà‡∏≠‡πÑ‡∏õ
        // ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á CSS ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ top/left ‡πÅ‡∏ó‡∏ô transform ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡∏Å‡∏±‡∏ö interact.js
        // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ transform ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡πà‡∏≤ data-x, data-y ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0
        // ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ CSS top/left ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á element

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        card.style.width = '';
        card.style.height = '';
      });
      console.log('Layout reset to default positions.');
    });


    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (‡πÑ‡∏°‡πà‡∏°‡∏µ filter)
    loadProcessDataWithDateFilter();

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô interact.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö draggable ‡πÅ‡∏•‡∏∞ resizable
    document.addEventListener('DOMContentLoaded', () => {
      // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
      document.querySelectorAll('.process-area').forEach(card => {
        const id = card.dataset.id;
        const savedPos = localStorage.getItem(`card-pos-${id}`);
        const savedSize = localStorage.getItem(`card-size-${id}`);

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ top, left ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å CSS
        const style = window.getComputedStyle(card);
        let x = 0; // interact.js will manage x,y based on translate()
        let y = 0;

        if (savedPos) {
          const loadedPos = JSON.parse(savedPos);
          x = loadedPos.x;
          y = loadedPos.y;
        }
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ else if (defaultPositions[id]) ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô CSS ‡πÅ‡∏•‡πâ‡∏ß
        // ‡πÅ‡∏•‡∏∞ interact.js ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô translate ‡∏à‡∏≤‡∏Å 0,0 ‡πÄ‡∏™‡∏°‡∏≠ ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ savedPos

        card.style.transform = `translate(${x}px, ${y}px)`;
        card.setAttribute('data-x', x);
        card.setAttribute('data-y', y);

        if (savedSize) {
          const { width, height } = JSON.parse(savedSize);
          card.style.width = width;
          card.style.height = height;
        }
      });

      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á interact.js
      interact('.process-area')
        .draggable({
          inertia: true,
          modifiers: [
            interact.modifiers.restrictRect({
              restriction: 'parent', // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô parent (factory-floor)
              endOnly: true
            })
          ],
          listeners: {
            start(event) {
              // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏Ç‡∏ì‡∏∞‡∏•‡∏≤‡∏Å‡∏ö‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™
              document.body.style.overflow = 'hidden';
              event.target.classList.add('dragging');
            },
            move(event) {
              const target = event.target;
              // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ x, y ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î
              const currentX = parseFloat(target.getAttribute('data-x')) || 0;
              const currentY = parseFloat(target.getAttribute('data-y')) || 0;

              // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà
              const x = currentX + event.dx;
              const y = currentY + event.dy;

              // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï transform ‡πÅ‡∏•‡∏∞ data attributes
              target.style.transform = `translate(${x}px, ${y}px)`;
              target.setAttribute('data-x', x);
              target.setAttribute('data-y', y);
            },
            end(event) {
              document.body.style.overflow = ''; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ overflow
              event.target.classList.remove('dragging');

              // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏•‡∏á localStorage
              const target = event.target;
              const pos = {
                x: parseFloat(target.getAttribute('data-x')) || 0,
                y: parseFloat(target.getAttribute('data-y')) || 0
              };
              localStorage.setItem(`card-pos-${target.dataset.id}`, JSON.stringify(pos));
            }
          }
        })
        .resizable({
          edges: { left: true, right: true, bottom: true, top: true },
          inertia: true,
          modifiers: [
            interact.modifiers.restrictEdges({
              outer: 'parent', // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô parent
              endOnly: true
            }),
            interact.modifiers.restrictSize({
              min: { width: 100, height: 80 } // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
            })
          ],
          listeners: {
            move(event) {
              const target = event.target;
              let x = (parseFloat(target.getAttribute('data-x')) || 0);
              let y = (parseFloat(target.getAttribute('data-y')) || 0);

              // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏ô‡∏≤‡∏î
              target.style.width = event.rect.width + 'px';
              target.style.height = event.rect.height + 'px';

              // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢)
              x += event.deltaRect.left;
              y += event.deltaRect.top;

              // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï transform ‡πÅ‡∏•‡∏∞ data attributes
              target.style.transform = `translate(${x}px, ${y}px)`;
              target.setAttribute('data-x', x);
              target.setAttribute('data-y', y);
            },
            end(event) {
              // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏•‡∏á localStorage
              const target = event.target;
              const size = {
                width: target.style.width,
                height: target.style.height
              };
              localStorage.setItem(`card-size-${target.dataset.id}`, JSON.stringify(size));

              // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
              const pos = {
                x: parseFloat(target.getAttribute('data-x')) || 0,
                y: parseFloat(target.getAttribute('data-y')) || 0
              };
              localStorage.setItem(`card-pos-${target.dataset.id}`, JSON.stringify(pos));
            }
          }
        })
        .styleCursor(false); // ‡πÉ‡∏´‡πâ interact.js ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ cursor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ CSS cursor: grab ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    });
  </script>
</body>
</html>
