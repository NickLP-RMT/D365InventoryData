<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>üì¶ Barcode Scanner 1D</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 400px;
      margin: 20px auto;
    }
    #scanner-container {
      width: 100%;
      height: 200px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    input, button {
      width: 100%;
      font-size: 16px;
      padding: 10px;
      margin-bottom: 10px;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

  <h2>üì¶ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î (1D)</h2>
  <div id="scanner-container"></div>

  <form id="barcode-form">
    <label>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label>
    <input type="text" id="barcode" name="barcode" readonly required />

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
    <input type="number" id="quantity" name="quantity" required min="1" />

    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô</label>
    <input type="text" id="scanner" name="scanner" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Nick" />

    <button type="submit">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>

  <div id="response"></div>

  <script>
    const scannerContainer = document.getElementById("scanner-container");
    const barcodeInput = document.getElementById("barcode");
    const responseBox = document.getElementById("response");
    const form = document.getElementById("barcode-form");

    // ‡πÄ‡∏£‡∏¥‡πà‡∏° QuaggaJS
    Quagga.init({
      inputStream: {
        type: "LiveStream",
        target: scannerContainer,
        constraints: {
          facingMode: "environment"
        }
      },
      decoder: {
        readers: ["ean_reader", "code_128_reader", "upc_reader", "code_39_reader"]
      }
    }, function (err) {
      if (err) {
        console.error(err);
        return;
      }
      Quagga.start();
    });

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î
    Quagga.onDetected((data) => {
      const code = data.codeResult.code;
      if (code) {
        barcodeInput.value = code;
        Quagga.stop();
      }
    });

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ submit
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      responseBox.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

      const formData = new URLSearchParams(new FormData(form));

      fetch("https://script.google.com/macros/s/AKfycbxXQERtTL47-EuckkSpNX3PEWeKvFidvxeIsoTvEmrJHrBldufGmmvxFORJFNXBiz4w/exec", {
        method: "POST",
        body: formData,
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            responseBox.innerHTML = `<p class="success">${data.message}</p>`;
            form.reset();
            barcodeInput.value = "";
            Quagga.start(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà
          } else {
            responseBox.innerHTML = `<p class="error">${data.message}</p>`;
          }
        })
        .catch((err) => {
          responseBox.innerHTML = `<p class="error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>`;
          console.error(err);
        });
    });
  </script>
</body>
</html>
