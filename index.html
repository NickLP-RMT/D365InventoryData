<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>üì¶ Barcode Scanner Submit</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 400px;
      margin: 20px auto;
      padding: 10px;
    }
    input, button {
      font-size: 16px;
      padding: 10px;
      margin-bottom: 15px;
      width: 100%;
    }
    #reader {
      width: 100%;
      margin-bottom: 20px;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>üì¶ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>

  <div id="reader"></div>

  <form id="barcode-form">
    <label>‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label>
    <input type="text" id="barcode" name="barcode" readonly required />

    <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
    <input type="number" id="quantity" name="quantity" required min="1" />

    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô</label>
    <input type="text" id="scanner" name="scanner" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Nick" />

    <button type="submit">üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </form>

  <div id="response"></div>

  <script>
    const form = document.getElementById("barcode-form");
    const barcodeInput = document.getElementById("barcode");
    const responseBox = document.getElementById("response");

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      { facingMode: "environment" }, // ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
      { fps: 10, qrbox: 250 },
      (decodedText) => {
        barcodeInput.value = decodedText;
        html5QrCode.stop();
        document.getElementById("quantity").focus();
      }
    );

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î Submit
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      responseBox.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";

      const formData = new URLSearchParams(new FormData(form));

      fetch("https://script.google.com/macros/s/AKfycbxXQERtTL47-EuckkSpNX3PEWeKvFidvxeIsoTvEmrJHrBldufGmmvxFORJFNXBiz4w/exec", {
        method: "POST",
        body: formData,
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            responseBox.innerHTML = `<p class="success">${data.message}</p>`;
            form.reset();
            barcodeInput.value = "";
            html5QrCode.start(
              { facingMode: "environment" },
              { fps: 10, qrbox: 250 },
              (decodedText) => {
                barcodeInput.value = decodedText;
                html5QrCode.stop();
                document.getElementById("quantity").focus();
              }
            );
          } else {
            responseBox.innerHTML = `<p class="error">${data.message}</p>`;
          }
        })
        .catch((err) => {
          responseBox.innerHTML = `<p class="error">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>`;
          console.error(err);
        });
    });
  </script>
</body>
</html>
