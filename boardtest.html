<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üè≠ Factory Layout Dashboard</title>
  <!-- Font Kanit -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-blue: #1e40af;
      --secondary-blue: #3b82f6;
      --light-blue: #dbeafe;
      --dark-blue: #1e3a8a;
      --accent-blue: #60a5fa;
      --white: #ffffff;
      --light-gray: #f8fafc;
      --border-gray: #e2e8f0;
      --text-dark: #1e293b;
      --text-light: #64748b;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --success-green: #10b981;
      --warning-orange: #f59e0b;
      --danger-red: #ef4444;
    }
    body {
      font-family: 'Kanit', sans-serif;
      background: linear-gradient(135deg, var(--light-gray) 0%, #e0f2fe 100%);
      min-height: 100vh;
      color: var(--text-dark);
      padding: 0;
      user-select: none;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
    /* Header ‡πÅ‡∏ö‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö 2 ‡πÅ‡∏ñ‡∏ß */
    .header {
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
      padding: 1rem 2rem 1.2rem 2rem;
      border-radius: 16px;
      margin-bottom: 1.2rem;
      box-shadow: var(--shadow-lg);
      color: var(--white);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 0;
      line-height: 1;
    }
    .header h1 i {
      font-size: 2.5rem;
      margin-top: 2px;
    }
    .header p {
      font-size: 1rem;
      opacity: 0.9;
      font-weight: 300;
      margin: 0;
    }
    .header-menu {
      display: flex;
      gap: 1rem;
    }
    .header-menu-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 12px;
      padding: 0.75rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--white);
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      user-select: none;
    }
    .header-menu-btn:hover:not(.active) {
      background: rgba(255,255,255,0.4);
      transform: translateY(-2px);
    }
    .header-menu-btn.active {
      background: var(--white);
      color: var(--primary-blue);
      font-weight: 700;
      cursor: default;
      box-shadow: var(--shadow-lg);
    }

    /* ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
    .factory-layout {
      background: var(--white);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      min-height: 80vh;
      overflow: hidden;
    }
    .layout-title {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 2rem;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
    }
    .factory-floor {
      position: relative;
      width: 100%;
      height: 750px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö process ‡πÄ‡∏û‡∏¥‡πà‡∏° */
      background: url('https://nicklp-rmt.github.io/D365InventoryData/pic/layout.jpg') no-repeat center center;
      background-size: cover;
      border: 3px solid var(--border-gray);
      border-radius: 12px;
      overflow: hidden;
    }

    /* Process Area */
    .process-area {
      position: absolute;
      border: 2px solid var(--border-gray);
      border-radius: 12px;
      background-color: rgba(255, 255, 255, 0.85);
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s ease;
      cursor: default;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 1rem;
      min-width: 150px;
      min-height: 120px;
      user-select: none;
    }
    .process-area:hover {
      box-shadow: var(--shadow-lg);
      z-index: 10;
    }
    .process-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      pointer-events: none;
    }
    .process-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      pointer-events: none;
    }
    .process-count {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-dark);
      pointer-events: none;
      min-height: 30px;
    }
    .process-status {
      font-size: 0.8rem;
      margin-top: 0.25rem;
      opacity: 0.8;
      pointer-events: none;
    }

    /* ‡∏™‡∏µ‡πÅ‡∏•‡∏∞ animation ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô */
    .high-volume {
      border-color: var(--success-green);
      background: linear-gradient(135deg, rgba(236, 253, 245, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-green 2s infinite;
    }
    .medium-volume {
      border-color: var(--warning-orange);
      background: linear-gradient(135deg, rgba(255, 251, 235, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-orange 2s infinite;
    }
    .low-volume {
      border-color: var(--danger-red);
      background: linear-gradient(135deg, rgba(254, 242, 242, 0.85) 0%, rgba(255, 255, 255, 0.85) 100%);
      animation: pulse-red 2s infinite;
    }

    @keyframes pulse-green {
      0%, 100% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(16,185,129,0); }
    }
    @keyframes pulse-orange {
      0%, 100% { box-shadow: 0 0 0 0 rgba(245,158,11,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(245,158,11,0); }
    }
    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(239,68,68,0); }
    }

    /* ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î process areas */
    .powder-mixing { top: 50px; left: 50px; }
    .compact       { top: 50px; left: 250px; }
    .sinter-steam  { top: 50px; left: 450px; }
    .finishing     { top: 200px; left: 50px; }
    .machining     { top: 200px; left: 250px; }
    .sub-store     { top: 200px; left: 450px; }
    .final-inspection { top: 350px; left: 50px; }
    .magna-flux    { top: 350px; left: 250px; }
    .sort          { top: 350px; left: 450px; }
    .pack          { top: 500px; left: 50px; }
    .rework        { top: 500px; left: 250px; }

    /* Resize handles (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö) */
    .resize-handle {
      position: absolute;
      background: var(--primary-blue);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 2;
    }
    .process-area:hover .resize-handle {
      opacity: 0.7;
    }
    .resize-handle:hover {
      opacity: 1 !important;
    }
    .resize-se {
      bottom: -3px;
      right: -3px;
      width: 12px;
      height: 12px;
      cursor: se-resize;
      border-radius: 0 0 12px 0;
    }
    .resize-s {
      bottom: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 6px;
      cursor: s-resize;
      border-radius: 0 0 6px 6px;
    }
    .resize-e {
      right: -3px;
      top: 50%;
      transform: translateY(-50%);
      width: 6px;
      height: 20px;
      cursor: e-resize;
      border-radius: 0 6px 6px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .factory-floor {
        height: 500px;
        transform: scale(0.8);
        transform-origin: top left;
      }
      .header {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
      }
      .header h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-row">
        <h1><i class="fas fa-industry"></i> Factory Layout Dashboard</h1>
        <div id="currentDatetime" style="font-size:1rem; font-weight: 500; opacity: 0.9;"></div>
      </div>
      <div class="header-row">
        <p>‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô CHP</p>
        <nav class="header-menu">
          <a href="boardtest.html" class="header-menu-btn active" id="btnDashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
          <a href="reporttest.html" class="header-menu-btn" id="btnSearch"><i class="fas fa-search"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</a>
        </nav>
      </div>
    </div>

    <div class="factory-layout">
      <div class="layout-title"><i class="fas fa-map"></i> ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô‡∏á‡∏≤‡∏ô</div>
      <div class="factory-floor">

        <!-- Process Areas -->
        <div class="process-area powder-mixing high-volume" data-id="powder-mixing">
          <div class="process-icon"><i class="fas fa-flask"></i></div>
          <div class="process-name">‡∏ú‡∏™‡∏°‡∏ú‡∏á</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area compact medium-volume" data-id="compact">
          <div class="process-icon"><i class="fas fa-compress-arrows-alt"></i></div>
          <div class="process-name">Compact</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area sinter-steam high-volume" data-id="sinter-steam">
          <div class="process-icon"><i class="fas fa-fire"></i></div>
          <div class="process-name">Sinter & Steam</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area finishing medium-volume" data-id="finishing">
          <div class="process-icon"><i class="fas fa-gem"></i></div>
          <div class="process-name">Finishing</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area machining high-volume" data-id="machining">
          <div class="process-icon"><i class="fas fa-cog"></i></div>
          <div class="process-name">Machining</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area sub-store medium-volume" data-id="sub-store">
          <div class="process-icon"><i class="fas fa-warehouse"></i></div>
          <div class="process-name">Sub Store</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area final-inspection medium-volume" data-id="final-inspection">
          <div class="process-icon"><i class="fas fa-clipboard-check"></i></div>
          <div class="process-name">Final Inspection</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area magna-flux low-volume" data-id="magna-flux">
          <div class="process-icon"><i class="fas fa-magnet"></i></div>
          <div class="process-name">Magna flux</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area sort medium-volume" data-id="sort">
          <div class="process-icon"><i class="fas fa-sort-amount-down"></i></div>
          <div class="process-name">Sort</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area pack medium-volume" data-id="pack">
          <div class="process-icon"><i class="fas fa-box"></i></div>
          <div class="process-name">Pack</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

        <div class="process-area rework low-volume" data-id="rework">
          <div class="process-icon"><i class="fas fa-tools"></i></div>
          <div class="process-name">Rework</div>
          <div class="process-count">0</div>
          <div class="process-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
          <div class="resize-handle resize-se"></div>
          <div class="resize-handle resize-s"></div>
          <div class="resize-handle resize-e"></div>
        </div>

      </div>
    </div>
  </div>

<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á client Supabase
  const supabaseClient = supabase.createClient(
    'https://fvjminqjxfracpvdbjly.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ2am1pbnFqeGZyYWNwdmRiamx5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxNTY4NTMsImV4cCI6MjA2ODczMjg1M30.N3X8-qSRQHa7FPIpbDlfL5ewY5_JeCShAuARczfmLgE'
  );

  const processList = [
    '‡∏ú‡∏™‡∏°‡∏ú‡∏á',
    'Compact',
    'Sinter & Steam',
    'Finishing',
    'Machining',
    'Sub Store',
    'Final Inspection',
    'Magna flux',
    'Sort',
    'Pack',
    'Rework'
  ];

  // ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ process ‡πÄ‡∏õ‡πá‡∏ô data-id class
  function getDataIdFromProcessName(procName) {
    const map = {
      '‡∏ú‡∏™‡∏°‡∏ú‡∏á': 'powder-mixing',
      'Compact': 'compact',
      'Sinter & Steam': 'sinter-steam',
      'Finishing': 'finishing',
      'Machining': 'machining',
      'Sub Store': 'sub-store',
      'Final Inspection': 'final-inspection',
      'Magna flux': 'magna-flux',
      'Sort': 'sort',
      'Pack': 'pack',
      'Rework': 'rework'
    };
    return map[procName] || '';
  }

  async function loadProcessData() {
    try {
      const { data, error } = await supabaseClient
        .from('inventory_tags')
        .select('main_process, quantity');

      if (error) {
        console.error('Error loading Supabase data:', error);
        return;
      }

      // ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πà‡∏≠ process
      const countMap = {};
      processList.forEach(p => countMap[p] = 0);

      data.forEach(row => {
        if(row.main_process && countMap.hasOwnProperty(row.main_process)) {
          countMap[row.main_process] += Number(row.quantity) || 0;
        }
      });

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
      processList.forEach(proc => {
        const dataId = getDataIdFromProcessName(proc);
        const el = document.querySelector(`.process-area[data-id="${dataId}"]`);
        if(el) {
          const countEl = el.querySelector('.process-count');
          if(countEl) {
            countEl.textContent = countMap[proc].toLocaleString();
          }
        }
      });
    } catch(e) {
      console.error('Exception loading process data:', e);
    }
  }

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ô header
  function updateDatetime() {
    const el = document.getElementById('currentDatetime');
    const now = new Date();
    el.textContent = now.toLocaleString('th-TH', {
      year: 'numeric', month: 'short', day: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    });
  }
  setInterval(updateDatetime, 1000);
  updateDatetime();

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• process ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
  loadProcessData();
</script>
</body>
</html>
